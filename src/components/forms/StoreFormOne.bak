import { StepperForm } from "../stepper/Stepper"
import { StepperGetStepDataProps } from "../stepper/Stepper"
import { AddressFields, AddressForm } from "./AddressForm"
import { StoreInfo, StoreInfoFields } from "./StoreInfo"
import { StoreImageForm } from "./StoreImageForm"
import { companyStoreService } from "../../services/companyStoreService"
import { useDispatch } from "react-redux"
import { addStore } from "../../store/profileSlice"
import { Finish } from "../../views/Finish"
import { ImageModel } from "../../models/image"
export type StoreStepperType = [{images:Array<ImageModel>},StoreInfoFields,AddressFields]
export function StoreForm(){
    const dispatch = useDispatch()
    const getStepData = (state:number):StepperGetStepDataProps=>{
        switch(state){
            case 0:
                return{
                    component:<StoreImageForm indexStepper={0} className="max-h-56"/>,
                    formsKeys:['images']
                }
            case 1:
                return {
                    component:<StoreInfo indexStepper={1}/>,
                    formsKeys:['title','categories','description']
                }
            case 2:
                return {
                    component:<AddressForm indexStepper={2}/>,
                    formsKeys:['address']
                }
            case 3:
                return {
                    component:(
                        <Finish
                            queryKey={['store-create']}
                            onSuccess={(data)=>{
                                dispatch(addStore(data.data))
                            }}
                            loader={{
                                message:{
                                    error:"ERROR CREATING THE STORE",
                                    success:"STORE CREATED"
                                },
                            redirect:() => {
                                return false;
                            }
                        }}/>    
                    ),
                    formsKeys:[]
                }
            default:
                return {
                    component:<div></div>,
                    formsKeys:[]
                }
        }
    }
    return (
            <StepperForm
                maxStep={4}
                stepLabels={['STORE IMAGE','STORE INFO','STORE ADDRESS']}
                getStepData={getStepData}
                onFinish={async(record)=>{
                    //alert("OK")
                    return await companyStoreService.createStore(
                        companyStoreService.serializeFromStepperData(record as StoreStepperType)
                    )
                
                }}
            >
            </StepperForm>
    )
}